---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import {
	GithubLogoIcon,
	RocketIcon,
	ArrowLeftIcon,
} from "@phosphor-icons/react/dist/ssr";
import Card from "@/components/Card.astro";

export async function getStaticPaths() {
	const projects = await getCollection("projects");
	return projects.map((project) => ({
		params: { slug: project.slug },
		props: { project },
	}));
}

const { project } = Astro.props;
const { Content } = await project.render();

const statusColors = {
	paused:
		"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300",
	developing:
		"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",
	finished:
		"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300",
};

const statusLabels = {
	paused: "Pausado",
	developing: "En desarrollo",
	finished: "Finalizado",
};
---

<BaseLayout pageTitle={`${project.data.title} - Proyecto`}>
	<section class="section-container relative z-10">
		<div class="w-full max-w-4xl mx-auto">
			<a
				href="/freelance/projects"
				class="inline-flex items-center gap-2 text-primary-400 dark:text-primary-300 hover:underline mb-8 animate-on-scroll"
			>
				<ArrowLeftIcon size={20} />
				Volver a proyectos
			</a>

			<div class="mb-8 animate-on-scroll" style="animation-delay: 0.1s;">
				<div class="aspect-video w-full overflow-hidden rounded-lg mb-6">
					<img
						src={project.data.imageUrl}
						alt={project.data.title}
						class="w-full h-full object-cover"
					/>
				</div>

				<div class="flex items-start justify-between mb-6">
					<h1
						class="text-4xl md:text-5xl font-bold text-shade-900 dark:text-shade-50"
					>
						{project.data.title}
					</h1>
					<span
						class={`px-4 py-2 rounded-full text-sm font-medium ${statusColors[project.data.status]}`}
					>
						{statusLabels[project.data.status]}
					</span>
				</div>

				<p class="text-xl text-shade-700 dark:text-shade-300 mb-6">
					{project.data.briefDescription}
				</p>

				<div class="flex flex-wrap gap-2 mb-6">
					{
						project.data.stack.map((tech) => (
							<span class="bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 px-3 py-1 rounded-full text-sm font-medium">
								{tech}
							</span>
						))
					}
				</div>

				<div class="flex gap-4">
					<a
						href={project.data.repoUrl}
						target="_blank"
						class="inline-flex items-center gap-2 px-6 py-3 bg-shade-800 hover:bg-shade-700 text-shade-50 rounded-lg transition-all font-semibold"
					>
						<GithubLogoIcon size={24} />
						Ver c√≥digo
					</a>
					{
						project.data.deployUrl && (
							<a
								href={project.data.deployUrl}
								target="_blank"
								class="inline-flex items-center gap-2 px-6 py-3 bg-primary-400 hover:bg-primary-300 text-white rounded-lg transition-all font-semibold"
							>
								<RocketIcon size={24} />
								Ver demo
							</a>
						)
					}
				</div>
			</div>

			<Card
				bgColor="var(--color-shade-100)"
				textColor="var(--color-shade-900)"
				className="animate-on-scroll"
				style="animation-delay: 0.2s;"
			>
				<div class="prose prose-lg dark:prose-invert max-w-none p-8">
					<Content />
				</div>
			</Card>
		</div>
	</section>
</BaseLayout>

<style is:global>
	.prose h1 {
		@apply text-3xl font-bold mt-8 mb-4;
	}
	.prose h2 {
		@apply text-2xl font-bold mt-6 mb-3;
	}
	.prose h3 {
		@apply text-xl font-bold mt-4 mb-2;
	}
	.prose p {
		@apply mb-4 leading-relaxed;
	}
	.prose ul {
		@apply list-disc list-inside mb-4;
	}
	.prose ol {
		@apply list-decimal list-inside mb-4;
	}
	.prose li {
		@apply mb-2;
	}
	.prose code {
		@apply bg-shade-200 dark:bg-shade-700 px-2 py-1 rounded text-sm;
	}
	.prose pre {
		@apply bg-shade-200 dark:bg-shade-700 p-4 rounded-lg overflow-x-auto mb-4;
	}
</style>
